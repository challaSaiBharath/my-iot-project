<!DOCTYPE html>
<html lang="en">

<head>
    <!-- ======================================================
       IoT ANNOUNCEMENT SYSTEM DASHBOARD
       ====================================================== -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT Announcement System</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body class="bg-light">

    <!-- ======================================================
       HEADER SECTION
  ====================================================== -->
    <header class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm sticky-top py-2">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold text-primary d-flex align-items-center" href="#">
                <i class="bi bi-megaphone-fill me-2"></i> IoT Announcement System
            </a>
            <div class="d-flex align-items-center">
                <button id="timetableBtn" class="btn btn-outline-primary me-2">
          <i class="bi bi-calendar-week"></i> Timetable
        </button>
                <button id="userBtn" class="btn btn-outline-secondary">
          <i class="bi bi-person-circle"></i> User
        </button>
            </div>
        </div>
    </header>

    <!-- ======================================================
       BODY LAYOUT
  ====================================================== -->
    <div class="d-flex">
        <!-- ==================== SIDEBAR ==================== -->
        <aside class="sidebar bg-dark text-white p-3 vh-100" style="width:260px;">
            <h5 class="text-center text-uppercase mb-4 border-bottom pb-2">Main Menu</h5>
            <ul class="nav flex-column">
                <li><a href="#" class="nav-link text-white active" data-page="dashboard"><i class="bi bi-speedometer2 me-2"></i> Dashboard</a></li>
                <li><a href="#" class="nav-link text-white" data-page="announcement"><i class="bi bi-broadcast me-2"></i> Announcements</a></li>
                <li><a href="#" class="nav-link text-white" data-page="rooms"><i class="bi bi-door-open me-2"></i> Rooms</a></li>
                <li><a href="#" class="nav-link text-white" data-page="status"><i class="bi bi-hdd-network me-2"></i> Status</a></li>
                <li><a href="#" class="nav-link text-white" data-page="logs"><i class="bi bi-journal-text me-2"></i> Logs</a></li>
            </ul>
            <hr>
            <small class="text-muted">Realtime Firebase Connected</small>
        </aside>

        <!-- ==================== MAIN CONTENT ==================== -->
        <main class="flex-grow-1 p-4" id="mainContent">

            <!-- ==================== DASHBOARD ==================== -->
            <section id="dashboardSection">
                <h4 class="fw-bold text-primary mb-4">üìä Dashboard Overview</h4>
                <div class="row g-3">
                    <div class="col-md-4">
                        <div class="card text-center shadow-sm">
                            <div class="card-body">
                                <i class="bi bi-display fs-1 text-success"></i>
                                <h6>Displays Connected</h6>
                                <h3 id="displayCount">--</h3>
                                <small class="text-muted">LCD/LED Online</small>
                                <button class="btn btn-sm btn-outline-success mt-2" id="refreshDisplay">Refresh</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center shadow-sm">
                            <div class="card-body">
                                <i class="bi bi-door-open fs-1 text-info"></i>
                                <h6>Active Rooms</h6>
                                <h3 id="activeRooms">--</h3>
                                <small class="text-muted">Classes in progress</small>
                                <button class="btn btn-sm btn-outline-info mt-2" id="refreshRooms">Refresh</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-center shadow-sm">
                            <div class="card-body">
                                <i class="bi bi-clock-history fs-1 text-warning"></i>
                                <h6>Next Event</h6>
                                <h5 id="nextEvent">--</h5>
                                <small class="text-muted">Upcoming from timetable</small>
                                <button class="btn btn-sm btn-outline-warning mt-2" id="checkNextEvent">Check</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-4 shadow-sm">
                    <div class="card-body">
                        <h5 class="fw-bold mb-3 text-secondary">Today's Timetable</h5>
                        <table class="table table-bordered text-center" id="todayTable">
                            <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Room</th>
                                    <th>Professor</th>
                                    <th>Subject</th>
                                    <th>Start</th>
                                    <th>End</th>
                                </tr>
                            </thead>
                            <tbody id="timetableBody">
                                <tr>
                                    <td colspan="6" class="text-muted">No data</td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="text-end">
                            <button id="reloadTimetable" class="btn btn-sm btn-outline-primary"><i class="bi bi-arrow-clockwise"></i> Reload Timetable</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== ANNOUNCEMENT ==================== -->
            <section id="announcementSection" class="d-none">
                <h4 class="fw-bold text-primary mb-4">üì¢ Announcements</h4>

                <div class="card border-0 shadow-sm mb-3">
                    <div class="card-body">
                        <h6 class="fw-bold">Text Announcement</h6>
                        <textarea id="textMsg" class="form-control mb-3" rows="3" placeholder="Type your announcement message..."></textarea>
                        <div class="d-flex justify-content-between">
                            <button id="sendText" class="btn btn-success"><i class="bi bi-send"></i> Send Text</button>
                            <button id="clearText" class="btn btn-outline-secondary"><i class="bi bi-x-circle"></i> Clear</button>
                        </div>
                        <div id="textPreview" class="border mt-3 p-2 small text-muted">Preview will appear here...</div>
                    </div>
                </div>

                <div class="card border-0 shadow-sm mb-3">
                    <div class="card-body">
                        <h6 class="fw-bold">Audio / Image / Video Announcement</h6>
                        <div class="d-flex gap-3 flex-wrap">
                            <button class="btn btn-outline-primary" id="audioRec"><i class="bi bi-mic"></i> Record Audio</button>
                            <button class="btn btn-outline-info" id="uploadImage"><i class="bi bi-image"></i> Upload Image</button>
                            <button class="btn btn-outline-warning" id="uploadVideo"><i class="bi bi-camera-video"></i> Upload Video</button>
                        </div>
                        <div class="mt-3 small text-muted">
                            <p>üé§ Click "Record Audio" to capture sound (requires microphone permission).</p>
                            <p>üñºÔ∏è Upload image/video to display content on connected LCD/LED displays.</p>
                        </div>
                    </div>
                </div>

                <div class="card border-0 shadow-sm mb-3">
                    <div class="card-body">
                        <h6 class="fw-bold">Rooms On/Off Control</h6>
                        <div id="roomSwitchContainer" class="d-flex flex-wrap gap-3">
                            <!-- Room toggle switches added dynamically -->
                        </div>
                    </div>
                </div>

                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <h6 class="fw-bold text-secondary">Announcement History</h6>
                        <ul id="announcementHistory" class="list-group small">
                            <li class="list-group-item text-muted">No previous announcements.</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- ==================== ROOMS ==================== -->
            <section id="roomsSection" class="d-none">
                <h4 class="fw-bold text-primary mb-4">üè´ Manage Rooms</h4>
                <div class="card shadow-sm border-0">
                    <div class="card-body">
                        <div class="input-group mb-3">
                            <input id="roomIdInput" type="text" placeholder="Enter Room Number" class="form-control">
                            <button id="addRoomBtn" class="btn btn-success"><i class="bi bi-plus-circle"></i> Add Room</button>
                            <button id="deleteRoomBtn" class="btn btn-danger"><i class="bi bi-trash"></i> Delete</button>
                        </div>
                        <ul id="roomList" class="list-group">
                            <li class="list-group-item text-muted">No rooms yet.</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- ==================== STATUS ==================== -->
            <section id="statusSection" class="d-none">
                <h4 class="fw-bold text-primary mb-4">üîå System Status</h4>
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card shadow-sm border-0">
                            <div class="card-body">
                                <h6>Displays</h6>
                                <p id="displayStatus" class="text-muted">Loading...</p>
                                <button id="refreshDisplayStatus" class="btn btn-sm btn-outline-primary">Refresh</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card shadow-sm border-0">
                            <div class="card-body">
                                <h6>Speakers</h6>
                                <p id="speakerStatus" class="text-muted">Checking...</p>
                                <button id="refreshSpeakerStatus" class="btn btn-sm btn-outline-primary">Refresh</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== LOGS ==================== -->
            <section id="logsSection" class="d-none">
                <h4 class="fw-bold text-primary mb-4">üóíÔ∏è Logs</h4>
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <h6>Realtime Log Entries</h6>
                        <div id="logsPanel" class="border bg-light p-3 rounded small" style="max-height:300px; overflow-y:auto;">
                            Waiting for log updates...
                        </div>
                        <button class="btn btn-sm btn-outline-danger mt-3" id="clearLogs"><i class="bi bi-trash"></i> Clear Logs</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- ======================================================
       FOOTER
  ====================================================== -->
    <footer class="text-center border-top py-3 mt-4 bg-white small text-muted">
        IoT Announcement System ¬© 2025 | Firebase + ESP8266 + WebApp
    </footer>

    <!-- ======================================================
       JS
  ====================================================== -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="script.js"></script>

</body>

</html>
